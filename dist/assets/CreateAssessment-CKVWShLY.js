import{u as H,r as l,j as e,N as V,C as f,b as y,s as F,L as j,g as Y,M as G}from"./index-BE97Blc-.js";import{u as K}from"./assessmentStore-CWi3OlGP.js";import{u as W}from"./resourceStore-CzSNu-NW.js";import{l as X}from"./index-CA1CrNgP.js";function ne(){const v=H(),{createAssessment:R,loading:N,error:Z}=K(),{resources:_,fetchAllResources:k,loading:A}=W(),[d,u]=l.useState({isOpen:!1,type:"info",title:"",message:""}),[a,m]=l.useState({title:"",prompt:"",externalLinks:[""]}),[c,b]=l.useState([{question_type:"multiple_choice",question_count:1,duration_per_question:120,num_options:4,positive_marks:1,negative_marks:0}]),[x,E]=l.useState([]),[p,M]=l.useState([]),[w,q]=l.useState(0),[O,C]=l.useState(""),[o,L]=l.useState(!1),h=l.useRef(null);l.useEffect(()=>{k();const t=X("https://gradeadmin.techmiresolutions.com/api",{transports:["websocket"],withCredentials:!0});return h.current=t,t.on("connect",()=>{console.log("Socket connected:",t.id)}),t.on("assessment-progress",s=>{q(s.percent),C(s.message)}),t.on("disconnect",()=>{console.log("Socket disconnected")}),()=>{t.disconnect()}},[k]);const S=r=>{const{name:t,value:s}=r.target;m(n=>({...n,[t]:s}))},i=(r,t,s)=>{b(n=>n.map((g,$)=>$===r?{...g,[t]:t==="question_count"||t==="duration_per_question"||t==="num_options"?Math.max(Number.parseInt(s)||1,1):t==="positive_marks"||t==="negative_marks"?s===""||s===null?null:Math.max(Number.parseFloat(s)||0,0):s}:g))},D=()=>{b(r=>[...r,{question_type:"multiple_choice",question_count:1,duration_per_question:120,num_options:4,positive_marks:1,negative_marks:0}])},P=r=>{c.length>1&&b(t=>t.filter((s,n)=>n!==r))},Q=()=>{m(r=>({...r,externalLinks:[...r.externalLinks,""]}))},B=r=>{m(t=>({...t,externalLinks:t.externalLinks.filter((s,n)=>n!==r)}))},T=(r,t)=>{m(s=>({...s,externalLinks:s.externalLinks.map((n,g)=>g===r?t:n)}))},z=r=>{M([...r.target.files])},I=r=>{E(t=>t.includes(r)?t.filter(s=>s!==r):[...t,r])},J=()=>{if(!a.title||!a.title.trim())return"Assessment Title is required";const r=x.length>0||p.length>0,t=a.externalLinks.some(s=>s&&s.trim());if(!a.prompt?.trim()&&!r&&!t)return"You must provide either a Prompt, Resources, or External Links";for(const s of c){if(!s.question_count||s.question_count<1)return"Question count must be at least 1";if(!s.duration_per_question||s.duration_per_question<30)return"Duration per question must be at least 30 seconds";if(s.question_type==="multiple_choice"&&(!s.num_options||s.num_options<2))return"Multiple choice needs at least 2 options"}return null},U=async r=>{r.preventDefault();const t=J();if(t){u({isOpen:!0,type:"error",title:"Validation Error",message:t});return}L(!0),q(0),C("Starting...");const s=new FormData;s.append("title",a.title?a.title.trim():null),s.append("prompt",a.prompt.trim()),s.append("externalLinks",JSON.stringify(a.externalLinks.filter(n=>n.trim()))),s.append("question_blocks",JSON.stringify(c.map(n=>({question_type:n.question_type,question_count:n.question_count,duration_per_question:n.duration_per_question,num_options:n.question_type==="multiple_choice"?n.num_options:null,positive_marks:n.positive_marks||1,negative_marks:n.negative_marks||0})))),s.append("selected_resources",JSON.stringify(x)),h.current?.id&&s.append("socketId",h.current.id),p.forEach(n=>s.append("new_files",n));try{await R(s),u({isOpen:!0,type:"success",title:"Success",message:"Assessment created successfully!"}),setTimeout(()=>{v("/instructor/assessments")},1500)}catch(n){u({isOpen:!0,type:"error",title:"Error",message:n.message||"Failed to create assessment"})}finally{L(!1)}};return e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-gray-50 to-blue-50",children:[e.jsx(V,{}),e.jsxs("div",{className:"max-w-5xl mx-auto px-4 sm:px-6 lg:px-8 py-8 sm:py-12",children:[e.jsxs("div",{className:"mb-8",children:[e.jsx("h1",{className:"text-3xl sm:text-4xl font-bold text-gray-900 mb-2",children:"Create New Assessment"}),e.jsx("p",{className:"text-gray-600",children:"Design a comprehensive assessment with customizable question blocks"})]}),o&&e.jsx(f,{className:"mb-6 border-blue-300 bg-gradient-to-r from-blue-50 to-indigo-50 shadow-lg",children:e.jsxs(y,{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"animate-spin rounded-full h-5 w-5 border-b-2 border-blue-600"}),e.jsx("p",{className:"text-sm font-medium text-blue-900",children:O})]}),e.jsxs("p",{className:"text-lg font-bold text-blue-900",children:[Math.round(w),"%"]})]}),e.jsx("div",{className:"w-full bg-blue-200 rounded-full h-3 overflow-hidden shadow-inner",children:e.jsx("div",{className:"bg-gradient-to-r from-blue-500 to-indigo-600 h-3 rounded-full transition-all duration-500 ease-out shadow-sm",style:{width:`${w}%`}})})]})}),e.jsxs("form",{onSubmit:U,className:"space-y-6",children:[e.jsxs(f,{className:"shadow-md hover:shadow-lg transition-shadow duration-300 border-0",children:[e.jsx(F,{className:"bg-gradient-to-r from-blue-600 to-indigo-600 text-white rounded-t-lg",children:e.jsx("h2",{className:"text-xl font-semibold",children:"ðŸ“ Assessment Details"})}),e.jsx(y,{className:"p-6 sm:p-8",children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsxs("label",{htmlFor:"title",className:"block text-sm font-semibold text-gray-700 mb-2",children:["Assessment Title ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"text",name:"title",id:"title",value:a.title,onChange:S,className:"w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all duration-200 hover:border-gray-300",placeholder:"e.g., Data Structures Final Exam",required:!0})]}),e.jsxs("div",{children:[e.jsxs("label",{htmlFor:"prompt",className:"block text-sm font-semibold text-gray-700 mb-2",children:["Prompt ",e.jsx("span",{className:"text-gray-500 font-normal",children:"(Optional if using resources or links)"})]}),e.jsx("textarea",{name:"prompt",id:"prompt",value:a.prompt,onChange:S,rows:5,className:"w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all duration-200 hover:border-gray-300 resize-none",placeholder:"Provide a detailed prompt for question generation. Describe the topics, difficulty level, and any specific requirements..."})]}),e.jsxs("div",{className:"bg-gray-50 rounded-lg p-6 border-2 border-gray-100",children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-4",children:"ðŸ“š Resources"}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"new_files",className:"block text-sm font-medium text-gray-700 mb-2",children:"Upload New Files"}),e.jsx("div",{className:"relative",children:e.jsx("input",{type:"file",id:"new_files",multiple:!0,accept:".pdf,.doc,.docx,.txt,.ppt,.pptx,.jpg,.jpeg,.png,.webp",onChange:z,className:"w-full px-4 py-3 border-2 border-dashed border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all duration-200 hover:border-blue-400 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-blue-50 file:text-blue-700 hover:file:bg-blue-100",disabled:o})}),p.length>0&&e.jsxs("div",{className:"mt-3 bg-white rounded-lg p-3 border border-gray-200",children:[e.jsx("p",{className:"text-xs font-semibold text-gray-600 mb-2",children:"Selected Files:"}),e.jsx("ul",{className:"space-y-1",children:p.map((r,t)=>e.jsxs("li",{className:"text-sm text-gray-700 flex items-center gap-2",children:[e.jsx("span",{className:"text-blue-600",children:"ðŸ“„"}),r.name]},t))})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Select Existing Resources"}),A?e.jsx("div",{className:"flex justify-center py-8",children:e.jsx(j,{size:"sm",type:"dots",color:"blue"})}):_.length>0?e.jsx("div",{className:"space-y-2 max-h-64 overflow-y-auto border-2 border-gray-200 rounded-lg p-4 bg-white",children:_.map(r=>e.jsxs("div",{className:"flex items-center p-2 hover:bg-gray-50 rounded-md transition-colors duration-150",children:[e.jsx("input",{type:"checkbox",id:`resource-${r.id}`,checked:x.includes(r.id),onChange:()=>I(r.id),className:"h-4 w-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500",disabled:o}),e.jsxs("label",{htmlFor:`resource-${r.id}`,className:"ml-3 text-sm text-gray-700 cursor-pointer flex-1",children:[e.jsx("span",{className:"font-medium",children:r.name}),e.jsxs("span",{className:"text-gray-500 ml-2",children:["(",r.content_type,")"]})]})]},r.id))}):e.jsx("div",{className:"text-center py-8 bg-white border-2 border-dashed border-gray-200 rounded-lg",children:e.jsx("p",{className:"text-gray-500",children:"No resources available"})})]})]})]}),e.jsxs("div",{className:"bg-gray-50 rounded-lg p-6 border-2 border-gray-100",children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-4",children:"ðŸ”— External Links"}),e.jsx("div",{className:"space-y-3",children:a.externalLinks.map((r,t)=>e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"url",value:r,onChange:s=>T(t,s.target.value),placeholder:"https://example.com/resource",className:"flex-1 px-4 py-3 border-2 border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all duration-200 hover:border-gray-300",disabled:o}),a.externalLinks.length>1&&e.jsx("button",{type:"button",onClick:()=>B(t),className:"px-4 py-3 bg-red-50 text-red-600 rounded-lg hover:bg-red-100 transition-colors duration-200 font-medium",disabled:o,children:"Remove"})]},t))}),e.jsx("button",{type:"button",onClick:Q,className:"mt-4 px-5 py-2.5 bg-blue-50 text-blue-600 rounded-lg hover:bg-blue-100 transition-colors duration-200 font-medium",disabled:o,children:"+ Add Link"})]})]})})]}),e.jsxs(f,{className:"shadow-md hover:shadow-lg transition-shadow duration-300 border-0",children:[e.jsx(F,{className:"bg-gradient-to-r from-indigo-600 to-purple-600 text-white rounded-t-lg",children:e.jsx("h2",{className:"text-xl font-semibold",children:"â“ Question Configuration"})}),e.jsx(y,{className:"p-6 sm:p-8",children:e.jsxs("div",{className:"space-y-6",children:[c.map((r,t)=>e.jsxs("div",{className:"p-6 border-2 border-gray-200 rounded-xl bg-gradient-to-br from-white to-gray-50 hover:border-blue-300 transition-all duration-300",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 flex items-center gap-2",children:e.jsxs("span",{className:"bg-blue-100 text-blue-700 px-3 py-1 rounded-full text-sm",children:["Block ",t+1]})}),c.length>1&&e.jsx("button",{type:"button",onClick:()=>P(t),className:"text-red-600 hover:text-red-800 font-medium hover:bg-red-50 px-3 py-1 rounded-lg transition-colors duration-200",disabled:o,children:"ðŸ—‘ï¸ Remove"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-5",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Question Type"}),e.jsxs("select",{value:r.question_type,onChange:s=>i(t,"question_type",s.target.value),className:"w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all duration-200 hover:border-gray-300 bg-white",disabled:o,children:[e.jsx("option",{value:"multiple_choice",children:"Multiple Choice"}),e.jsx("option",{value:"true_false",children:"True/False"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Question Count"}),e.jsx("input",{type:"number",value:r.question_count,onChange:s=>i(t,"question_count",s.target.value),min:"1",placeholder:"e.g. 5",className:"w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all duration-200 hover:border-gray-300",required:!0,disabled:o})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Duration (seconds)"}),e.jsx("input",{type:"number",value:r.duration_per_question,onChange:s=>i(t,"duration_per_question",s.target.value),min:"30",placeholder:"e.g. 120",className:"w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all duration-200 hover:border-gray-300",required:!0,disabled:o})]}),r.question_type==="multiple_choice"&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Number of Options"}),e.jsx("input",{type:"number",value:r.num_options,onChange:s=>i(t,"num_options",s.target.value),min:"2",max:"6",placeholder:"2 to 6",className:"w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all duration-200 hover:border-gray-300",required:!0,disabled:o})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Positive Marks"}),e.jsx("input",{type:"number",value:r.positive_marks||"",onChange:s=>i(t,"positive_marks",s.target.value),min:"0",step:"0.1",placeholder:"e.g. 1",className:"w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all duration-200 hover:border-gray-300",disabled:o})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Negative Marks"}),e.jsx("input",{type:"number",value:r.negative_marks||"",onChange:s=>i(t,"negative_marks",s.target.value),min:"0",step:"0.1",placeholder:"e.g. 0.25",className:"w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all duration-200 hover:border-gray-300",disabled:o})]})]})]},t)),e.jsx("button",{type:"button",onClick:D,className:"w-full py-3 bg-gradient-to-r from-blue-50 to-indigo-50 text-blue-600 rounded-lg hover:from-blue-100 hover:to-indigo-100 transition-all duration-200 font-semibold border-2 border-dashed border-blue-300 hover:border-blue-400",disabled:o,children:"+ Add Question Block"})]})})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row justify-end gap-3 pt-4",children:[e.jsx("button",{type:"button",onClick:()=>v("/instructor/assessments"),className:"px-8 py-3 border-2 border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-all duration-200 font-medium order-2 sm:order-1",disabled:o,children:"Cancel"}),e.jsx("button",{type:"submit",className:"px-8 py-3 bg-gradient-to-r from-blue-600 to-indigo-600 text-white rounded-lg hover:from-blue-700 hover:to-indigo-700 transition-all duration-200 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center font-semibold shadow-md hover:shadow-lg order-1 sm:order-2",disabled:N||o,children:o?e.jsxs(e.Fragment,{children:[e.jsx(j,{size:"sm",color:"white",type:"gradient"}),e.jsx("span",{className:"ml-2",children:"Processing..."})]}):N?e.jsxs(e.Fragment,{children:[e.jsx(j,{size:"sm",color:"white",type:"gradient"}),e.jsx("span",{className:"ml-2",children:"Creating..."})]}):e.jsx(e.Fragment,{children:e.jsx("span",{children:"âœ¨ Create Assessment"})})})]})]})]}),e.jsx(Y,{}),e.jsx(G,{isOpen:d.isOpen,onClose:()=>u({...d,isOpen:!1}),type:d.type,title:d.title,children:d.message})]})}export{ne as default};
