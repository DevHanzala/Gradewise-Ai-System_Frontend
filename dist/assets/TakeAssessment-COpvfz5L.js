import{K,u as p,O as j,h as W,r as g,j as e,L as $,C as q,q as T,ag as H,a2 as V,y as z,k as O,G as Z,f as ee,m as se,M as te,P as v}from"./index-BE97Blc-.js";import{u as I}from"./useStudentAnalyticsStore-CyWanBkV.js";const N="https://gradeadmin.techmiresolutions.com/api",Y=K((n,S)=>({assessmentQuestions:[],timeRemaining:0,loading:!1,error:null,isSubmitted:!1,submission:null,attemptId:null,language:"en",hasStarted:!1,startAssessment:async(o,a="en")=>{n({loading:!0,error:null});try{const t=localStorage.getItem("token");if(!t){console.warn("âš ï¸ No token found in localStorage"),n({error:"Please log in to start the assessment",loading:!1}),p()("/login");return}const i=await j.post(`${N}/taking/assessments/${o}/start`,{language:a},{headers:{Authorization:`Bearer ${t}`}});if(i.data.success)n({assessmentQuestions:i.data.data.questions.map(r=>{let d=null;try{d=r.options?typeof r.options=="string"?JSON.parse(r.options):r.options:null,Array.isArray(d)||(console.warn(`âš ï¸ Invalid options format for question ${r.id}:`,r.options),d=null)}catch(f){console.error(`âŒ Failed to parse options for question ${r.id}:`,f.message,r.options),d=null}return{...r,answer:null,options:d,correct_answer:r.correct_answer,positive_marks:r.positive_marks,negative_marks:r.negative_marks,duration_per_question:r.duration_per_question}}),timeRemaining:(i.data.data.duration||15)*60,isSubmitted:!1,attemptId:i.data.data.attemptId,language:a,loading:!1,hasStarted:!0});else throw new Error(i.data.message||"Failed to start assessment")}catch(t){console.error(`âŒ startAssessment error for ID ${o}:`,t.response?.data||t);const i=t.response?.data?.message==="Assessment not found"?`Assessment with ID ${o} does not exist. Please check the assessment ID or contact your instructor.`:t.response?.data?.message||"Failed to start assessment";n({error:i,loading:!1,hasStarted:!1}),i.includes("log in")&&p()("/login")}},updateAnswer:(o,a)=>{n(t=>({assessmentQuestions:t.assessmentQuestions.map(i=>i.id===o?{...i,answer:a}:i)}))},submitAssessment:async o=>{const{attemptId:a,hasStarted:t,language:i,assessmentQuestions:r}=S();if(!t||!a){console.warn("âš ï¸ Cannot submit: Assessment not started"),n({error:"Assessment not started",loading:!1});return}n({loading:!0,error:null});try{const d=localStorage.getItem("token");if(!d){console.warn("âš ï¸ No token found in localStorage"),n({error:"Please log in to submit the assessment",loading:!1}),p()("/login");return}const f=r.map(c=>({questionId:c.id,answer:c.answer})),m=await j.post(`${N}/taking/assessments/${o}/submit`,{attemptId:a,answers:f,language:i},{headers:{Authorization:`Bearer ${d}`}});if(m.data.success)n({isSubmitted:!0,loading:!1,submission:m.data.data}),I.getState().fetchOverview(),I.getState().fetchPerformance(),I.getState().fetchRecommendations();else throw new Error(m.data.message||"Failed to submit assessment")}catch(d){console.error("âŒ submitAssessment error:",d.response?.data||d);const f=d.response?.data?.message||"Failed to submit assessment";n({error:f,loading:!1}),f.includes("log in")&&p()("/login")}},printPaper:async o=>{n({loading:!0,error:null});try{const a=localStorage.getItem("token");if(!a){console.warn("âš ï¸ No token found in localStorage for print"),n({error:"Please log in to print the assessment",loading:!1}),p()("/login");return}const t=await j.get(`${N}/taking/assessments/${o}/print`,{headers:{Authorization:`Bearer ${a}`},responseType:"blob"}),i=window.URL.createObjectURL(new Blob([t.data])),r=document.createElement("a");r.href=i,r.setAttribute("download",`assessment_${o}.pdf`),document.body.appendChild(r),r.click(),document.body.removeChild(r),n({loading:!1})}catch(a){console.error("âŒ printPaper error:",a.response?.data||a);const t=a.response?.data?.message||"Failed to print assessment";n({error:t,loading:!1}),t.includes("log in")&&p()("/login")}},getSubmissionDetails:async o=>{n({loading:!0,error:null,submission:null});try{const a=localStorage.getItem("token");if(!a){console.warn("âš ï¸ No token found in localStorage for submission details"),n({error:"Please log in to view submission details",loading:!1}),p()("/login");return}const t=await j.get(`${N}/taking/submissions/${o}`,{headers:{Authorization:`Bearer ${a}`}});if(t.data.success)n({submission:t.data.data,loading:!1});else throw new Error(t.data.message||"Failed to load submission details")}catch(a){console.error("âŒ getSubmissionDetails error:",a.response?.data||a);const t=a.response?.data?.message||"Failed to load submission details";n({error:t,loading:!1}),t.includes("log in")&&p()("/login")}},clearError:()=>{n({error:null})},reset:()=>{n({assessmentQuestions:[],timeRemaining:0,loading:!1,error:null,isSubmitted:!1,submission:null,attemptId:null,hasStarted:!1})}}));function ne(){const{assessmentId:n}=W(),S=p(),{assessmentQuestions:o,timeRemaining:a,loading:t,error:i,startAssessment:r,updateAnswer:d,submitAssessment:f,isSubmitted:m,hasStarted:c,clearError:E}=Y(),[u,k]=g.useState(0),[h,A]=g.useState({isOpen:!1,type:"",title:"",message:""}),[y,B]=g.useState("en"),[F,R]=g.useState(!1),[L,D]=g.useState(!1);g.useEffect(()=>{c&&D(["ur","ar","fa"].includes(y))},[c,y]);const M=async()=>{try{await r(n,y),v.success("Assessment started!")}catch(s){v.error(s.message||"Failed to start")}},_=async()=>{if(!(F||m)){R(!0);try{await f(n),A({isOpen:!0,type:"success",title:"Submitted!",message:"Your assessment has been submitted successfully."}),v.success("Submitted successfully!")}catch(s){v.error(s.message||"Submission failed")}finally{R(!1)}}};g.useEffect(()=>{if(a>0&&c&&!m){const s=setInterval(()=>{Y.setState(x=>x.timeRemaining<=1?(_(),{timeRemaining:0}):{timeRemaining:x.timeRemaining-1})},1e3);return()=>clearInterval(s)}else a<=0&&c&&!m&&_()},[a,c,m]);const l=o[u],b=l?.duration_per_question||30,[w,P]=g.useState(b);g.useEffect(()=>P(b),[u,b]),g.useEffect(()=>{if(!c||m||w<=0)return;const s=setInterval(()=>{P(x=>x<=1&&u<o.length-1?(k(J=>J+1),b):x-1)},1e3);return()=>clearInterval(s)},[w,c,m,u,o.length,b]);const U=()=>u>0&&k(s=>s-1),G=()=>u<o.length-1&&k(s=>s+1),C=(s,x)=>d(s,x);g.useEffect(()=>{i&&(A({isOpen:!0,type:"error",title:"Error",message:i}),E())},[i,E]);const X=o.filter(s=>s.answer!==void 0).length,Q=s=>`${Math.floor(s/60)}:${(s%60).toString().padStart(2,"0")}`;return t&&!c?e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-indigo-600 via-purple-600 to-blue-600 flex items-center justify-center p-4",children:e.jsx("div",{className:"text-center",children:e.jsxs("div",{className:"bg-white/10 backdrop-blur-md rounded-3xl p-8 sm:p-12 shadow-2xl",children:[e.jsx($,{size:"lg",type:"gradient",color:"purple"}),e.jsx("p",{className:"mt-6 text-xl sm:text-2xl font-bold text-white",children:"Loading Assessment..."}),e.jsx("p",{className:"mt-2 text-sm text-blue-100",children:"Please wait while we prepare your exam"})]})})}):e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-gray-900 via-indigo-900 to-purple-900",dir:L?"rtl":"ltr",children:[!c&&e.jsx("div",{className:"min-h-screen flex items-center justify-center p-4",children:e.jsxs(q,{className:"w-full max-w-2xl shadow-2xl rounded-2xl sm:rounded-3xl overflow-hidden border-2 border-indigo-500/50 animate-fade-in",children:[e.jsxs("div",{className:"bg-gradient-to-r from-indigo-600 via-purple-600 to-indigo-600 text-white p-6 sm:p-8 text-center relative overflow-hidden",children:[e.jsx("div",{className:"absolute inset-0 bg-white/10 backdrop-blur-sm"}),e.jsxs("div",{className:"relative z-10",children:[e.jsx(T,{className:"text-5xl sm:text-6xl mx-auto mb-4 animate-bounce"}),e.jsx("h1",{className:"text-2xl sm:text-3xl lg:text-4xl font-extrabold mb-2",children:"Welcome to Your Assessment"}),e.jsx("p",{className:"text-blue-100 text-sm sm:text-base",children:"Select your preferred language and begin"})]})]}),e.jsxs("div",{className:"p-6 sm:p-10 space-y-6 sm:space-y-8 bg-white",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"flex items-center gap-2 text-lg font-bold text-gray-800 mb-3",children:[e.jsx(H,{className:"text-indigo-600"}),"Select Language"]}),e.jsxs("select",{value:y,onChange:s=>B(s.target.value),className:"w-full p-4 text-base sm:text-lg border-2 border-indigo-200 rounded-xl focus:border-indigo-600 focus:ring-4 focus:ring-indigo-200 transition-all font-semibold",children:[e.jsx("option",{value:"en",children:"ðŸ‡¬ðŸ‡§ English"}),e.jsx("option",{value:"ur",children:"ðŸ‡µðŸ‡° Urdu"}),e.jsx("option",{value:"ar",children:"ðŸ‡¸ðŸ‡¦ Arabic"}),e.jsx("option",{value:"fa",children:"ðŸ‡®ðŸ‡· Persian"})]})]}),e.jsxs("div",{className:"bg-gradient-to-r from-blue-50 to-indigo-50 border-2 border-indigo-200 rounded-xl p-4 sm:p-5",children:[e.jsxs("h3",{className:"font-bold text-indigo-900 mb-2 flex items-center gap-2",children:[e.jsx(V,{}),"Instructions"]}),e.jsxs("ul",{className:"text-sm text-gray-700 space-y-1",children:[e.jsx("li",{children:"â€¢ Read each question carefully before answering"}),e.jsx("li",{children:"â€¢ You can navigate between questions using Previous/Next buttons"}),e.jsx("li",{children:"â€¢ Make sure to submit before time runs out"}),e.jsx("li",{children:"â€¢ Your progress is automatically saved"})]})]}),e.jsx("button",{onClick:M,disabled:t,className:"w-full py-4 sm:py-5 bg-gradient-to-r from-indigo-600 via-purple-600 to-indigo-600 text-white text-lg sm:text-xl font-bold rounded-xl sm:rounded-2xl shadow-2xl hover:shadow-indigo-500/50 transition-all disabled:opacity-60 transform hover:-translate-y-1 active:translate-y-0 flex items-center justify-center gap-3",children:t?e.jsxs(e.Fragment,{children:[e.jsx($,{size:"sm",color:"white",type:"dots"}),e.jsx("span",{children:"Starting..."})]}):e.jsxs(e.Fragment,{children:[e.jsx(T,{}),e.jsx("span",{children:"Start Assessment"})]})})]})]})}),c&&!m&&l&&e.jsxs("div",{className:"min-h-screen flex flex-col",children:[e.jsx("div",{className:"bg-gradient-to-r from-gray-900 to-indigo-900 shadow-2xl border-b-4 border-indigo-500 sticky top-0 z-50 backdrop-blur-md",children:e.jsx("div",{className:"max-w-7xl mx-auto px-3 sm:px-6 py-3 sm:py-4",children:e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3",children:[e.jsxs("div",{className:"flex items-center gap-3 sm:gap-6 text-sm sm:text-base",children:[e.jsxs("div",{className:"bg-indigo-600 text-white px-3 sm:px-4 py-2 rounded-lg font-bold flex items-center gap-2",children:[e.jsx(z,{}),e.jsx("span",{className:"hidden xs:inline",children:"Q"})," ",u+1,"/",o.length]}),e.jsxs("div",{className:"bg-green-600 text-white px-3 sm:px-4 py-2 rounded-lg font-bold flex items-center gap-2",children:[e.jsx(O,{}),e.jsx("span",{className:"hidden xs:inline",children:X})]})]}),e.jsxs("div",{className:"flex gap-2 sm:gap-3",children:[e.jsxs("div",{className:`${w<=5?"bg-red-600 animate-pulse":"bg-red-500"} text-white px-3 sm:px-5 py-2 rounded-lg font-bold flex items-center gap-2 shadow-lg`,children:[e.jsx(Z,{}),Q(w)]}),e.jsxs("div",{className:"bg-purple-600 text-white px-3 sm:px-5 py-2 rounded-lg font-bold flex items-center gap-2 shadow-lg",children:[e.jsx("span",{className:"hidden xs:inline",children:"Total:"})," ",Q(a)]})]})]})})}),e.jsx("div",{className:"flex-1 flex items-center justify-center p-3 sm:p-6",children:e.jsx("div",{className:"w-full max-w-5xl",children:e.jsxs("div",{className:"bg-white rounded-2xl sm:rounded-3xl shadow-2xl overflow-hidden border-2 border-indigo-500/30 animate-slide-in",children:[e.jsx("div",{className:"bg-gradient-to-r from-indigo-600 via-purple-600 to-indigo-600 text-white p-4 sm:p-6 text-center",children:e.jsxs("h2",{className:"text-xl sm:text-2xl lg:text-3xl font-extrabold flex items-center justify-center gap-2 sm:gap-3",children:[e.jsx(z,{className:"animate-pulse"}),"Question ",u+1," of ",o.length]})}),e.jsxs("div",{className:"p-4 sm:p-8 lg:p-10 space-y-6 sm:space-y-8 animate-fade-in",children:[e.jsx("div",{className:"text-center bg-gradient-to-r from-blue-50 to-indigo-50 border-2 border-indigo-200 rounded-2xl p-5 sm:p-6 lg:p-8",children:e.jsx("p",{className:"text-lg sm:text-xl lg:text-2xl font-semibold leading-relaxed text-gray-900",children:l.question_text})}),e.jsxs("div",{className:"flex justify-center gap-3 sm:gap-6",children:[e.jsxs("span",{className:"bg-green-100 text-green-800 px-4 sm:px-6 py-2 sm:py-3 rounded-xl text-base sm:text-lg font-bold border-2 border-green-300 shadow-md",children:["+",l.positive_marks||1]}),l.negative_marks>0&&e.jsxs("span",{className:"bg-red-100 text-red-800 px-4 sm:px-6 py-2 sm:py-3 rounded-xl text-base sm:text-lg font-bold border-2 border-red-300 shadow-md",children:["-",l.negative_marks]})]}),l.question_type==="multiple_choice"&&e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3 sm:gap-4",children:l.options?.map((s,x)=>e.jsxs("button",{onClick:()=>C(l.id,s),className:`p-4 sm:p-6 rounded-xl sm:rounded-2xl text-base sm:text-lg lg:text-xl font-semibold transition-all border-4 shadow-lg hover:shadow-xl transform hover:-translate-y-1 active:translate-y-0 ${l.answer===s?"border-indigo-600 bg-gradient-to-r from-indigo-100 to-purple-100 scale-105 shadow-indigo-300":"border-gray-300 bg-white hover:border-indigo-400"}`,children:[e.jsxs("span",{className:"font-bold text-indigo-600 mr-2",children:[String.fromCharCode(65+x),"."]}),s]},x))}),l.question_type==="true_false"&&e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4 sm:gap-8 max-w-3xl mx-auto",children:["True","False"].map(s=>e.jsx("button",{onClick:()=>C(l.id,s==="True"),className:`p-8 sm:p-12 rounded-2xl sm:rounded-3xl text-2xl sm:text-3xl lg:text-4xl font-extrabold transition-all border-8 shadow-2xl hover:shadow-3xl transform hover:-translate-y-2 active:translate-y-0 ${l.answer===(s==="True")?s==="True"?"border-green-600 bg-gradient-to-br from-green-50 to-green-100 text-green-700 scale-105":"border-red-600 bg-gradient-to-br from-red-50 to-red-100 text-red-700 scale-105":"border-gray-300 bg-white hover:border-gray-400"}`,children:s==="True"?"âœ“ TRUE":"âœ— FALSE"},s))}),l.question_type==="short_answer"&&e.jsx("textarea",{value:l.answer||"",onChange:s=>C(l.id,s.target.value),placeholder:"Type your answer here...",rows:6,className:"w-full p-4 sm:p-6 text-base sm:text-lg border-4 border-indigo-200 rounded-2xl focus:border-indigo-600 resize-none focus:ring-4 focus:ring-indigo-200 transition-all"})]}),e.jsxs("div",{className:"bg-gradient-to-r from-gray-50 to-blue-50 p-4 sm:p-6 flex flex-col sm:flex-row justify-between items-center gap-3 sm:gap-4 border-t-2 border-gray-200",children:[e.jsxs("button",{onClick:U,disabled:u===0,className:"w-full sm:w-auto flex items-center justify-center gap-2 sm:gap-3 px-5 sm:px-6 py-3 bg-white border-2 border-gray-300 text-gray-800 rounded-xl font-bold disabled:opacity-50 hover:bg-gray-50 hover:border-gray-400 transition-all shadow-md",children:[e.jsx(ee,{}),e.jsx("span",{children:"Previous"})]}),u===o.length-1?e.jsx("button",{onClick:_,disabled:F,className:"w-full sm:w-auto flex items-center justify-center gap-2 sm:gap-3 px-6 sm:px-8 py-3 sm:py-4 bg-gradient-to-r from-green-600 to-emerald-600 text-white font-bold rounded-xl shadow-2xl hover:shadow-green-500/50 transition-all disabled:opacity-50 transform hover:-translate-y-1 active:translate-y-0",children:F?e.jsxs(e.Fragment,{children:[e.jsx($,{size:"sm",color:"white",type:"dots"}),e.jsx("span",{children:"Submitting..."})]}):e.jsxs(e.Fragment,{children:[e.jsx(O,{}),e.jsx("span",{children:"Submit Exam"})]})}):e.jsxs("button",{onClick:G,className:"w-full sm:w-auto flex items-center justify-center gap-2 sm:gap-3 px-6 sm:px-8 py-3 sm:py-4 bg-gradient-to-r from-indigo-600 to-purple-600 text-white font-bold rounded-xl shadow-2xl hover:shadow-indigo-500/50 transition-all transform hover:-translate-y-1 active:translate-y-0",children:[e.jsx("span",{children:"Next Question"}),e.jsx(se,{})]})]})]})})})]}),e.jsx(te,{isOpen:h.isOpen,onClose:()=>{A({...h,isOpen:!1}),h.type==="success"&&S("/student/dashboard")},type:h.type,title:h.title,children:e.jsx("p",{className:"text-lg sm:text-xl text-center",children:h.message})}),e.jsx("style",{jsx:!0,children:`
        @keyframes slide-in {
          from {
            opacity: 0;
            transform: translateX(${L?"-100%":"100%"}) scale(0.95);
          }
          to {
            opacity: 1;
            transform: translateX(0) scale(1);
          }
        }
        @keyframes fade-in {
          from {
            opacity: 0;
            transform: translateY(20px);
          }
          to {
            opacity: 1;
            transform: translateY(0);
          }
        }
        .animate-slide-in {
          animation: slide-in 0.5s cubic-bezier(0.4, 0, 0.2, 1);
        }
        .animate-fade-in {
          animation: fade-in 0.6s ease-out;
        }
      `})]})}export{ne as default};
