import{K as _,O as d,P as l}from"./index-BE97Blc-.js";const u="https://gradeadmin.techmiresolutions.com/api",A=_(s=>({assessments:[],studentAssessments:[],getStudentAssessments:async()=>{s({loading:!0,error:null});try{const t=localStorage.getItem("token");if(!t)throw new Error("No authentication token found");const e=await d.get(`${u}/taking/assessments`,{headers:{Authorization:`Bearer ${t}`}});e.data.success?s({studentAssessments:e.data.data||[],loading:!1}):s({error:e.data.message,loading:!1})}catch(t){const e=t.response?.data?.message||t.message||"Failed to fetch student assessments";throw s({error:e,loading:!1,studentAssessments:[]}),l.error(e),t}},currentAssessment:null,enrolledStudents:[],loading:!1,error:null,getInstructorAssessments:async()=>{s({loading:!0,error:null});try{const t=localStorage.getItem("token");if(!t)throw new Error("No authentication token found");const e=await d.get(`${u}/assessments/instructor`,{headers:{Authorization:`Bearer ${t}`}});e.data.success?s({assessments:e.data.data.map(r=>({...r,is_executed:r.is_executed||!1})),loading:!1}):s({error:e.data.message,loading:!1})}catch(t){const e=t.response?.data?.message||t.message||"Failed to fetch assessments";throw s({error:e,loading:!1}),l.error(e),t}},getAssessmentById:async t=>{s({loading:!0,error:null});try{if(!t||isNaN(parseInt(t)))throw new Error("Invalid assessment ID");const e=localStorage.getItem("token");if(!e)throw new Error("No authentication token found");const r=await d.get(`${u}/assessments/${parseInt(t)}`,{headers:{Authorization:`Bearer ${e}`}});if(r.data.success)return s({currentAssessment:r.data.data,loading:!1}),r.data.data;throw new Error(r.data.message)}catch(e){const r=e.response?.data?.message||e.message||"Failed to fetch assessment";throw s({error:r,loading:!1}),l.error(r),e}},createAssessment:async t=>{s({loading:!0,error:null});try{const e=localStorage.getItem("token");if(!e)throw new Error("No authentication token found");const r=t.get("title"),o=t.get("prompt"),i=JSON.parse(t.get("externalLinks")||"[]"),g=JSON.parse(t.get("question_blocks")||"[]"),p=JSON.parse(t.get("selected_resources")||"[]"),h=t.getAll("new_files");if(!r?.trim())throw new Error("Assessment Title is required");const w=p.length>0||h.length>0,f=i.some(n=>n&&n.trim());if(!o?.trim()&&!w&&!f)throw new Error("You must provide either a Prompt, Resources, or External Links");if(g.length>0)for(const n of g){if(!n.question_count||n.question_count<1)throw new Error("Question count must be at least 1");if(!n.duration_per_question||n.duration_per_question<30)throw new Error("Duration per question must be at least 30 seconds");if(n.question_type==="multiple_choice"&&(!n.num_options||n.num_options<2))throw new Error("Multiple choice needs at least 2 options")}const c=new FormData;c.append("title",r.trim()),c.append("prompt",o?.trim()||null),c.append("externalLinks",JSON.stringify(i.filter(n=>n&&n.trim()))),c.append("question_blocks",JSON.stringify(g)),c.append("selected_resources",JSON.stringify(p)),h.forEach(n=>c.append("new_files",n));const m=await d.post(`${u}/assessments`,c,{headers:{Authorization:`Bearer ${e}`,"Content-Type":"multipart/form-data"}});if(m.data.success)return s(n=>({assessments:[...n.assessments,{...m.data.data,is_executed:!1}],loading:!1})),m.data.data;throw new Error(m.data.message)}catch(e){const r=e.response?.data?.message||e.message||"Failed to create assessment";throw s({error:r,loading:!1}),l.error(r),e}},updateAssessment:async(t,e)=>{s({loading:!0,error:null});try{if(!t||isNaN(parseInt(t)))throw new Error("Invalid assessment ID");const r=localStorage.getItem("token");if(!r)throw new Error("No authentication token found");const o=e.get("title")?.trim(),i=e.get("prompt")?.trim(),g=JSON.parse(e.get("externalLinks")||"[]"),p=JSON.parse(e.get("selected_resources")||"[]"),h=e.getAll("new_files");if(!o)throw new Error("Assessment Title is required");const w=g.some(a=>a&&a.trim()),f=p.length>0,c=h.length>0;if(!i&&!w&&!f&&!c)throw new Error("You must keep the existing prompt OR provide new Prompt, Resources, or Links");const m=JSON.parse(e.get("question_blocks")||"[]");if(m.length>0)for(const a of m){if(!a.question_count||a.question_count<1)throw new Error("Question count must be at least 1");if(!a.duration_per_question||a.duration_per_question<30)throw new Error("Duration per question must be at least 30 seconds");if(a.question_type==="multiple_choice"&&(!a.num_options||a.num_options<2))throw new Error("Multiple choice needs at least 2 options")}const n=await d.put(`${u}/assessments/${parseInt(t)}`,e,{headers:{Authorization:`Bearer ${r}`}});if(n.data.success){const a=n.data.data;return s(E=>({assessments:E.assessments.map(k=>k.id===t?{...a,is_executed:k.is_executed}:k),currentAssessment:a,loading:!1})),l.success("Assessment updated successfully!"),a}else throw new Error(n.data.message||"Update failed")}catch(r){const o=r.response?.data?.message||r.message||"Failed to update assessment";throw console.error("Update Assessment Error:",o),s({error:o,loading:!1}),l.error(o),r}},deleteAssessment:async t=>{s({loading:!0,error:null});try{if(!t||isNaN(parseInt(t)))throw new Error("Invalid assessment ID");const e=localStorage.getItem("token");if(!e)throw new Error("No authentication token found");const r=await d.delete(`${u}/assessments/${parseInt(t)}`,{headers:{Authorization:`Bearer ${e}`}});if(r.data.success)s(o=>({assessments:o.assessments.filter(i=>i.id!==Number.parseInt(t)),loading:!1}));else throw new Error(r.data.message)}catch(e){const r=e.response?.data?.message||e.message||"Failed to delete assessment";throw s({error:r,loading:!1}),l.error(r),e}},getEnrolledStudents:async t=>{s({loading:!0,error:null});try{if(!t||isNaN(parseInt(t)))throw new Error("Invalid assessment ID");const e=localStorage.getItem("token");if(!e)throw new Error("No authentication token found");const r=await d.get(`${u}/assessments/${parseInt(t)}/enrolled-students`,{headers:{Authorization:`Bearer ${e}`}});if(r.data.success)return s({enrolledStudents:r.data.data,loading:!1}),r.data.data;throw new Error(r.data.message)}catch(e){const r=e.response?.data?.message||e.message||"Failed to fetch enrolled students";throw s({error:r,loading:!1}),l.error(r),e}},enrollStudent:async(t,e)=>{s({loading:!0,error:null});try{if(!t||isNaN(parseInt(t)))throw new Error("Invalid assessment ID");if(!e||!e.trim())throw new Error("Student email is required and must be a valid string");const r=localStorage.getItem("token");if(!r)throw new Error("No authentication token found");const o=await d.post(`${u}/assessments/${parseInt(t)}/enroll`,{email:e.trim()},{headers:{Authorization:`Bearer ${r}`}});if(o.data.success)return s(i=>({enrolledStudents:[...i.enrolledStudents,o.data.data],loading:!1})),o.data.data;throw new Error(o.data.message)}catch(r){const o=r.response?.data?.message||r.message||"Failed to enroll student";throw s({error:o,loading:!1}),l.error(o),r}},unenrollStudent:async(t,e)=>{s({loading:!0,error:null});try{if(!t||isNaN(parseInt(t)))throw new Error("Invalid assessment ID");if(!e||isNaN(parseInt(e)))throw new Error("Invalid student ID");const r=localStorage.getItem("token");if(!r)throw new Error("No authentication token found");const o=await d.delete(`${u}/assessments/${parseInt(t)}/enroll/${parseInt(e)}`,{headers:{Authorization:`Bearer ${r}`}});if(o.data.success)return s(i=>({enrolledStudents:i.enrolledStudents.filter(g=>g.id!==Number.parseInt(e)),loading:!1})),o.data.data;throw new Error(o.data.message)}catch(r){const o=r.response?.data?.message||r.message||"Failed to unenroll student";throw s({error:o,loading:!1}),l.error(o),r}},clearError:()=>{s({error:null})},clearCurrentAssessment:()=>{s({currentAssessment:null})}}));export{A as u};
